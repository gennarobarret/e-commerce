{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, ChangeDetectionStrategy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet LoginComponent = class LoginComponent {\n  constructor(formBuilder, _authService, _router, _toastService, cdr) {\n    this.formBuilder = formBuilder;\n    this._authService = _authService;\n    this._router = _router;\n    this._toastService = _toastService;\n    this.cdr = cdr;\n    this.user = {};\n    this.token = '';\n    this.token = this._authService.getToken();\n    this.loginForm = this.formBuilder.group({\n      email: ['', [Validators.required, Validators.email]],\n      password: ['', Validators.required]\n    });\n  }\n  ngOnInit() {\n    if (this.token) {\n      this._router.navigate(['']);\n    }\n  }\n  login() {\n    if (this.loginForm.valid) {\n      const {\n        email,\n        password\n      } = this.loginForm.value;\n      const data = {\n        email,\n        password\n      };\n      this._authService.login_admin(data).subscribe(response => {\n        if (!response.data) {\n          this._toastService.showToast('error', 'There was an error during login');\n        } else {\n          this.handleSuccessfulLogin(response);\n        }\n      }, error => {\n        this._toastService.showToast('error', 'There was an error during login');\n        console.error(error);\n      });\n    } else {\n      this._toastService.showToast('error', 'Invalid form data');\n    }\n  }\n  handleSuccessfulLogin(response) {\n    this.user = response.data;\n    localStorage.setItem('token', response.token || '');\n    this._router.navigate(['/']);\n  }\n};\nLoginComponent = __decorate([Component({\n  selector: 'app-login',\n  templateUrl: './login.component.html',\n  styleUrls: ['./login.component.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush // Mejora en la detección de cambios\n})], LoginComponent);\nexport { LoginComponent };\n// import { Component } from '@angular/core';\n// @Component({\n//   selector: 'app-login',\n//   templateUrl: './login.component.html',\n//   styleUrls: ['./login.component.css']\n// })\n// export class LoginComponent {\n// }","map":{"version":3,"names":["Component","ChangeDetectionStrategy","Validators","LoginComponent","constructor","formBuilder","_authService","_router","_toastService","cdr","user","token","getToken","loginForm","group","email","required","password","ngOnInit","navigate","login","valid","value","data","login_admin","subscribe","response","showToast","handleSuccessfulLogin","error","console","localStorage","setItem","__decorate","selector","templateUrl","styleUrls","changeDetection","OnPush"],"sources":["C:\\Users\\Javier\\Documents\\proyectos\\e-commerce\\admin\\src\\app\\modules\\auth\\login\\login.component.ts"],"sourcesContent":["import { Component, OnInit, ChangeDetectionStrategy } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AuthService } from 'src/app/core/auth/auth.service';\nimport { ToastService } from 'src/app/shared/services/toast.service';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { catchError, finalize } from 'rxjs/operators';\nimport { throwError } from 'rxjs';\nimport { LoginCredentials } from 'src/app/core/model';\n\n\n\ninterface ApiResponse {\n  data?: any;\n  token?: string;\n}\n\n@Component({\n  selector: 'app-login',\n  templateUrl: './login.component.html',\n  styleUrls: ['./login.component.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush // Mejora en la detección de cambios\n})\nexport class LoginComponent implements OnInit {\n  public user: any = {};\n  public token: any = '';\n  public loginForm: FormGroup;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private _authService: AuthService,\n    private _router: Router,\n    private _toastService: ToastService,\n    private cdr: ChangeDetectorRef\n  ) {\n    this.token = this._authService.getToken();\n    this.loginForm = this.formBuilder.group({\n      email: ['', [Validators.required, Validators.email]],\n      password: ['', Validators.required],\n    });\n  }\n\n  ngOnInit(): void {\n    if (this.token) {\n      this._router.navigate(['']);\n    }\n  }\n\n  login() {\n    if (this.loginForm.valid) {\n      const { email, password } = this.loginForm.value;\n      const data = { email, password };\n      this._authService.login_admin(data).subscribe(\n        (response: ApiResponse) => {\n          if (!response.data) {\n            this._toastService.showToast('error', 'There was an error during login');\n          } else {\n            this.handleSuccessfulLogin(response);\n          }\n        },\n        (error) => {\n          this._toastService.showToast('error', 'There was an error during login');\n          console.error(error);\n        }\n      );\n    } else {\n      this._toastService.showToast('error', 'Invalid form data');\n    }\n  }\n\n  private handleSuccessfulLogin(response: ApiResponse) {\n    this.user = response.data;\n    localStorage.setItem('token', response.token || '');\n    this._router.navigate(['/']);\n  }\n\n}\n\n// import { Component } from '@angular/core';\n\n// @Component({\n//   selector: 'app-login',\n//   templateUrl: './login.component.html',\n//   styleUrls: ['./login.component.css']\n// })\n// export class LoginComponent {\n\n// }\n"],"mappings":";AAAA,SAASA,SAAS,EAAUC,uBAAuB,QAAQ,eAAe;AAI1E,SAAiCC,UAAU,QAAQ,gBAAgB;AAkBnE,IAAaC,cAAc,GAA3B,MAAaA,cAAc;EAKzBC,YACUC,WAAwB,EACxBC,YAAyB,EACzBC,OAAe,EACfC,aAA2B,EAC3BC,GAAsB;IAJtB,KAAAJ,WAAW,GAAXA,WAAW;IACX,KAAAC,YAAY,GAAZA,YAAY;IACZ,KAAAC,OAAO,GAAPA,OAAO;IACP,KAAAC,aAAa,GAAbA,aAAa;IACb,KAAAC,GAAG,GAAHA,GAAG;IATN,KAAAC,IAAI,GAAQ,EAAE;IACd,KAAAC,KAAK,GAAQ,EAAE;IAUpB,IAAI,CAACA,KAAK,GAAG,IAAI,CAACL,YAAY,CAACM,QAAQ,EAAE;IACzC,IAAI,CAACC,SAAS,GAAG,IAAI,CAACR,WAAW,CAACS,KAAK,CAAC;MACtCC,KAAK,EAAE,CAAC,EAAE,EAAE,CAACb,UAAU,CAACc,QAAQ,EAAEd,UAAU,CAACa,KAAK,CAAC,CAAC;MACpDE,QAAQ,EAAE,CAAC,EAAE,EAAEf,UAAU,CAACc,QAAQ;KACnC,CAAC;EACJ;EAEAE,QAAQA,CAAA;IACN,IAAI,IAAI,CAACP,KAAK,EAAE;MACd,IAAI,CAACJ,OAAO,CAACY,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC;;EAE/B;EAEAC,KAAKA,CAAA;IACH,IAAI,IAAI,CAACP,SAAS,CAACQ,KAAK,EAAE;MACxB,MAAM;QAAEN,KAAK;QAAEE;MAAQ,CAAE,GAAG,IAAI,CAACJ,SAAS,CAACS,KAAK;MAChD,MAAMC,IAAI,GAAG;QAAER,KAAK;QAAEE;MAAQ,CAAE;MAChC,IAAI,CAACX,YAAY,CAACkB,WAAW,CAACD,IAAI,CAAC,CAACE,SAAS,CAC1CC,QAAqB,IAAI;QACxB,IAAI,CAACA,QAAQ,CAACH,IAAI,EAAE;UAClB,IAAI,CAACf,aAAa,CAACmB,SAAS,CAAC,OAAO,EAAE,iCAAiC,CAAC;SACzE,MAAM;UACL,IAAI,CAACC,qBAAqB,CAACF,QAAQ,CAAC;;MAExC,CAAC,EACAG,KAAK,IAAI;QACR,IAAI,CAACrB,aAAa,CAACmB,SAAS,CAAC,OAAO,EAAE,iCAAiC,CAAC;QACxEG,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;MACtB,CAAC,CACF;KACF,MAAM;MACL,IAAI,CAACrB,aAAa,CAACmB,SAAS,CAAC,OAAO,EAAE,mBAAmB,CAAC;;EAE9D;EAEQC,qBAAqBA,CAACF,QAAqB;IACjD,IAAI,CAAChB,IAAI,GAAGgB,QAAQ,CAACH,IAAI;IACzBQ,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEN,QAAQ,CAACf,KAAK,IAAI,EAAE,CAAC;IACnD,IAAI,CAACJ,OAAO,CAACY,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;EAC9B;CAED;AArDYhB,cAAc,GAAA8B,UAAA,EAN1BjC,SAAS,CAAC;EACTkC,QAAQ,EAAE,WAAW;EACrBC,WAAW,EAAE,wBAAwB;EACrCC,SAAS,EAAE,CAAC,uBAAuB,CAAC;EACpCC,eAAe,EAAEpC,uBAAuB,CAACqC,MAAM,CAAC;CACjD,CAAC,C,EACWnC,cAAc,CAqD1B;SArDYA,cAAc;AAuD3B;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA"},"metadata":{},"sourceType":"module","externalDependencies":[]}